import{r as l,j as s,M as E,Z as k,_ as C}from"./index-Q5swbgvz.js";import{D as I}from"./DataTable-CKEvAOaE.js";/* empty css                       */const F=()=>{const[t,r]=l.useState([]),[v,m]=l.useState(!0),[x,c]=l.useState(null),[n,j]=l.useState(""),[N,d]=l.useState(!1),[i,o]=l.useState(null),[p,u]=l.useState(!1),[a,S]=l.useState(null),b=[{key:"id",label:"ID",sortable:!0},{key:"user_id",label:"Usuario",sortable:!0},{key:"ip_address",label:"IP",sortable:!1},{key:"device_info",label:"Dispositivo",sortable:!1},{key:"started_at",label:"Inicio",sortable:!0},{key:"ended_at",label:"Fin",sortable:!0},{key:"is_active",label:"Activa",sortable:!0,render:e=>e?"Sí":"No"}];l.useEffect(()=>{(async()=>{try{m(!0);const h=await getSessions();r(Array.isArray(h)?h:[]),c(null)}catch{c("Error al cargar las sesiones. Por favor, inténtalo de nuevo."),r([])}finally{m(!1)}})()},[]);const y=Array.isArray(t)?t.filter(e=>(e.ip_address||"").includes(n)||(e.device_info||"").toLowerCase().includes(n.toLowerCase())||(e.user_id+"").includes(n)):[],_=e=>{e.preventDefault()},g=e=>{S(e),u(!0)},f=e=>{o(e),d(!0)},D=async()=>{if(i)try{await C(i.session_id),r(t.map(e=>e.id===i.id?{...e,is_active:!1}:e)),d(!1),o(null)}catch{c("Error al finalizar la sesión. Por favor, inténtalo de nuevo.")}},w=()=>{d(!1),o(null)};return s.jsxs("div",{className:"admin-content",children:[s.jsx("div",{className:"page-header",children:s.jsx("h1",{children:"Gestión de Sesiones"})}),s.jsx("div",{className:"search-bar",children:s.jsxs("form",{onSubmit:_,children:[s.jsx("input",{type:"text",placeholder:"Buscar por IP, dispositivo o ID de usuario...",value:n,onChange:e=>j(e.target.value)}),s.jsx("button",{type:"submit",children:s.jsx(E,{})})]})}),s.jsx(I,{data:y,columns:b,title:"Sesiones de usuarios",onView:g,onDelete:f,loading:v,error:x,emptyMessage:"No hay sesiones registradas"}),N&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal",children:[s.jsx("h2",{children:"Confirmar finalización de sesión"}),s.jsxs("p",{children:["¿Estás seguro de que deseas finalizar la sesión del usuario ",s.jsx("strong",{children:i==null?void 0:i.user_id}),"?"]}),s.jsx("p",{children:"Esta acción cerrará la sesión del usuario y tendrá que volver a iniciar sesión."}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"cancel-button",onClick:w,children:"Cancelar"}),s.jsx("button",{className:"confirm-button",onClick:D,children:"Finalizar sesión"})]})]})}),p&&a&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal session-modal",children:[s.jsx("h2",{children:"Detalles de la sesión"}),s.jsxs("div",{className:"session-details",children:[s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"ID de sesión:"}),s.jsx("span",{className:"field-value",children:a.session_id})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"ID de usuario:"}),s.jsx("span",{className:"field-value",children:a.user_id})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Dirección IP:"}),s.jsx("span",{className:"field-value",children:a.ip_address})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Dispositivo:"}),s.jsx("span",{className:"field-value",children:a.device_info})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Navegador:"}),s.jsx("span",{className:"field-value",children:a.user_agent})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Inicio de sesión:"}),s.jsx("span",{className:"field-value",children:a.started_at?new Date(a.started_at).toLocaleString():""})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Última actividad:"}),s.jsx("span",{className:"field-value",children:a.last_activity?new Date(a.last_activity).toLocaleString():""})]}),s.jsxs("div",{className:"session-field",children:[s.jsx("span",{className:"field-label",children:"Estado:"}),s.jsx("span",{className:`status-badge ${a.is_active?"active":"inactive"}`,children:a.is_active?"Activa":"Finalizada"})]})]}),s.jsxs("div",{className:"modal-actions",children:[a.is_active&&s.jsxs("button",{className:"danger-button",onClick:()=>{u(!1),f(a)},children:[s.jsx(k,{})," Finalizar sesión"]}),s.jsx("button",{className:"cancel-button",onClick:()=>u(!1),children:"Cerrar"})]})]})})]})};export{F as default};
