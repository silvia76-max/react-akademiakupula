import{r as l,A as S,T as k,j as e,M,U as T,V as D,W as L}from"./index-BXbcqYUm.js";import{D as R}from"./DataTable-C3u3g1_w.js";const V=()=>{const[i,c]=l.useState([]),[f,n]=l.useState(!0),[p,o]=l.useState(null),[d,x]=l.useState(""),[s,b]=l.useState(null),[y,u]=l.useState(!1),[m,h]=l.useState("");S();const v=[{key:"id",label:"ID",sortable:!0},{key:"nombre",label:"Nombre",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"telefono",label:"Teléfono",sortable:!1},{key:"curso",label:"Curso",sortable:!0},{key:"mensaje",label:"Mensaje",sortable:!1},{key:"estado",label:"Estado",sortable:!0},{key:"fecha_creacion",label:"Fecha",sortable:!0}],j=l.useCallback(async()=>{try{n(!0);const a=await k();c(a||[]),o(null)}catch{o("Error al cargar los mensajes. Por favor, inténtalo de nuevo."),c([])}finally{n(!1)}},[]);l.useEffect(()=>{j()},[j]);const C=i.filter(a=>a.nombre.toLowerCase().includes(d.toLowerCase())||a.email.toLowerCase().includes(d.toLowerCase())||a.mensaje.toLowerCase().includes(d.toLowerCase())),g=a=>{a.preventDefault()},w=a=>{if(b(a),u(!0),!a.leido){const t=i.map(r=>r.id===a.id?{...r,leido:!0}:r);c(t)}},E=async a=>{if(window.confirm("¿Estás seguro de que deseas eliminar este mensaje?"))try{n(!0),await D(a);const t=i.filter(r=>r.id!==a);c(t),o(null)}catch(t){console.error(`Error al eliminar el mensaje ${a}:`,t),o("Error al eliminar el mensaje. Por favor, inténtalo de nuevo.")}finally{n(!1)}},N=async a=>{if(a.preventDefault(),!m.trim()){alert("Por favor, escribe un mensaje de respuesta.");return}try{n(!0),await L(s.id,m);const t=i.map(r=>r.id===s.id?{...r,leido:!0}:r);c(t),alert(`Respuesta enviada a ${s.email}`),h(""),u(!1),o(null)}catch(t){console.error(`Error al responder al mensaje ${s.id}:`,t),o("Error al enviar la respuesta. Por favor, inténtalo de nuevo.")}finally{n(!1)}};return e.jsxs("div",{className:"admin-content",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:"Gestión de Mensajes"})}),e.jsx("div",{className:"search-bar",children:e.jsxs("form",{onSubmit:g,children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre, email o contenido...",value:d,onChange:a=>x(a.target.value)}),e.jsx("button",{type:"submit",children:e.jsx(M,{})})]})}),e.jsx(R,{data:C,columns:v,title:"Mensajes de contacto",onView:w,onDelete:E,loading:f,error:p,emptyMessage:"No hay mensajes de contacto"}),y&&s&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Mensaje de ",s.nombre]}),e.jsx("button",{className:"close-button",onClick:()=>u(!1),children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"contact-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Teléfono:"})," ",s.telefono]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(s.fecha_creacion).toLocaleString()]})]}),e.jsxs("div",{className:"message-content",children:[e.jsx("h3",{children:"Mensaje:"}),e.jsx("p",{children:s.mensaje})]}),e.jsxs("div",{className:"reply-form",children:[e.jsx("h3",{children:"Responder:"}),e.jsxs("form",{onSubmit:N,children:[e.jsx("textarea",{value:m,onChange:a=>h(a.target.value),placeholder:"Escribe tu respuesta aquí...",rows:5}),e.jsxs("button",{type:"submit",className:"reply-button",children:[e.jsx(T,{})," Enviar Respuesta"]})]})]})]})]})})]})};export{V as default};
